# Close Page

A secure HTTPS server that runs on port 443 and serves a close page for pre-configured local domains. Automatically generates self-signed SSL certificates and manages trusted root certificate installation.

## Features

- **HTTPS Server on Port 443**: Runs a secure web server on the standard HTTPS port
- **Auto SSL Certificate Generation**: Creates self-signed certificates with Subject Alternative Names (SAN) for multiple domains
- **Trusted Root Integration**: Automatically installs certificates into Windows Trusted Root store
- **Pre-configured Domains**: Reads local domains from Windows hosts file (127.0.0.1 entries)
- **Close Page Handler**: Serves `close.html` as the default landing page
- **Logging**: All server requests are logged to `server.log`
- **Autostart Capability**: Runs automatically via Windows startup shortcut

## Project Structure

```
close_page/
├── update.py              # Certificate and server setup script
├── server.py              # HTTPS server implementation
├── close.html             # Landing page content
├── run_update.ps1         # PowerShell script to run update.py
├── C++/                   # C++ wrapper source (compiles to .exe)
├── openssl_san.cnf        # OpenSSL configuration (generated)
├── cert.pem               # SSL certificate (generated)
├── key.pem                # SSL private key (generated)
├── server.log             # Server request logs (generated)
└── README.md              # This file
```

## How It Works

### 1. `update.py` - Setup Script

This script prepares the environment:

- **Reads Hosts File**: Extracts all domains configured as `127.0.0.1` in `C:\Windows\System32\drivers\etc\hosts`
- **Generates OpenSSL Config**: Creates `openssl_san.cnf` with SAN entries for all discovered domains
- **Creates SSL Certificates**: 
  - Generates self-signed certificate (`cert.pem`) valid for 365 days
  - Creates private key (`key.pem`) with 2048-bit RSA encryption
- **Installs Certificates**: 
  - Removes old certificates from Windows Trusted Root store
  - Imports new certificate to avoid browser warnings
- **Updates Server**: Regenerates `server.py` with current certificate paths

**Run once before first use:**
```powershell
python update.py
```

### 2. `server.py` - HTTPS Server

A Python HTTPS server that:

- **Listens on Port 443**: All HTTPS traffic for configured domains
- **Routes Root Path**: Redirects `/` to `/close.html`
- **Logs All Requests**: Records client IP, requested path, and errors
- **Error Handling**: Gracefully handles request exceptions
- **SSL Encryption**: Uses certificate and key generated by `update.py`

**Run manually:**
```powershell
python server.py
```

### 3. `close.html` - Landing Page

The web page served to users when they visit any configured domain.

## Installation & Setup

### Prerequisites

- Python 3.7+
- OpenSSL (typically included with Python)
- Windows (for certificate store integration and autostart)
- Administrator privileges (required for port 443 and certificate installation)

### Step 1: Configure Local Domains

Edit `C:\Windows\System32\drivers\etc\hosts` and add your domains:

```hosts
127.0.0.1   allideasofanime.com
127.0.0.1   example.com
127.0.0.1   yoursite.local
```

### Step 2: Run Setup Script

Open PowerShell **as Administrator** and run:

```powershell
Start-Process powershell -Verb runAs
```

Then navigate to the project directory and execute:

```powershell
cd C:\close_page
python update.py
```

This will:
- Generate SSL certificates for your domains
- Import them into Windows Trusted Root store
- Prepare the server

### Step 3: Test the Server

Run the server manually:

```powershell
python server.py
```

Visit `https://allideasofanime.com:443/` in your browser (adjust domain as needed).

### Step 4: Setup Autostart (Optional)

To run the server automatically on Windows startup:

1. **Compile the C++ Wrapper**:
   - Open the C++ project in Visual Studio
   - Build as Release (creates `.exe`)
   - This `.exe` will run the Python server with admin privileges and hidden window

2. **Copy to Autostart**:
   - Locate your compiled `.exe` file
   - Copy it to the Windows Startup folder: `%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup`
   - The file will run automatically on next Windows restart

3. **Alternative - Create Shortcut**:
   - Right-click the `.exe` file → Send to → Desktop (create shortcut)
   - Right-click shortcut → Properties → Advanced → Check "Run as administrator"
   - Move the shortcut to the Startup folder above

4. **Verify**:
   - Restart Windows
   - Server should start automatically
   - Check `server.log` for confirmation that it's running

## File Reference

| File | Purpose |
|------|---------|
| `update.py` | Setup script - generates certs, installs them, updates server.py |
| `server.py` | HTTPS server - handles requests on port 443 |
| `close.html` | Landing page - served at root path |
| `run_update.ps1` | PowerShell script to run update.py with proper environment |
| `C++/` | C++ source code that compiles to Windows `.exe` |
| `openssl_san.cnf` | OpenSSL configuration with SAN entries (auto-generated) |
| `cert.pem` | SSL certificate (auto-generated) |
| `key.pem` | SSL private key (auto-generated) |
| `server.log` | Request/error logs (auto-generated) |

## Logging

All server requests and errors are logged to `server.log`:

```
2025-12-07 10:45:23,123 - INFO - 127.0.0.1 requested /close.html
2025-12-07 10:45:24,456 - INFO - 127.0.0.1 - "GET /close.html HTTP/1.1" 200 -
```

View logs in real-time:
```powershell
Get-Content server.log -Wait
```

## Troubleshooting

### Port 443 Already in Use
```powershell
netstat -ano | findstr :443
taskkill /PID <pid> /F
```

### Certificate Not Trusted
- Ensure `update.py` ran successfully
- Check `C:\Windows\System32\drivers\etc\hosts` for correct domain configuration
- Manually import certificate: Right-click `cert.pem` → Install Certificate → Trusted Root

### Server Won't Start as Admin
- Run `python server.py` from an Administrator PowerShell
- Or compile the C++ wrapper and set it to run as admin

### Domains Not Working
- Verify hosts file entries: `127.0.0.1 yourdomain.com`
- Flush DNS cache: `ipconfig /flushdns`
- Restart browser

## Security Notes

⚠️ **Self-Signed Certificates**: These certificates are not signed by a Certificate Authority and are intended for local testing only.

⚠️ **Admin Privileges Required**: Running on port 443 and certificate installation requires administrator rights.

⚠️ **Localhost Only**: This setup is designed for local development (127.0.0.1). Do not expose to the internet.

## License

MIT

## Author

Created for local domain testing and redirect functionality.
